{% extends "base.html" %}

{% block title %}Dashboard - Manuela Metais{% endblock %}

{% block breadcrumb %}
    <span>â€º</span>
    <span>Dashboard</span>
{% endblock %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card">
        <h3>Total de Clientes</h3>
        <div class="value" id="total-clientes">0</div>
    </div>
    <div class="stat-card">
        <h3>Total de Produtos</h3>
        <div class="value" id="total-produtos">0</div>
    </div>
    <div class="stat-card negative">
        <h3>Contas a Pagar</h3>
        <div class="value" id="total-pagar">R$ 0,00</div>
    </div>
    <div class="stat-card positive">
        <h3>Contas a Receber</h3>
        <div class="value" id="total-receber">R$ 0,00</div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2>ğŸ“Š VisÃ£o Geral do Sistema</h2>
    </div>
    
    <div style="line-height: 2;">
        <p style="font-size: 16px; color: var(--gray-700); margin-bottom: 30px;">
            Bem-vindo ao sistema de gestÃ£o da Manuela Metais. Use o menu superior para navegar entre as diferentes funcionalidades.
        </p>

        <h3 style="color: var(--primary); margin-bottom: 15px; font-size: 18px;">ğŸ¯ MÃ³dulos DisponÃ­veis:</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
            <div style="padding: 20px; background: var(--gray-50); border-radius: var(--radius-md); border-left: 3px solid var(--primary);">
                <h4 style="color: var(--primary); margin-bottom: 10px;">ğŸ‘¥ GestÃ£o de Clientes</h4>
                <p style="color: var(--gray-600); font-size: 14px;">Cadastro completo com controle de saldo, negativaÃ§Ã£o e adiantamento de pagamentos.</p>
            </div>
            
            <div style="padding: 20px; background: var(--gray-50); border-radius: var(--radius-md); border-left: 3px solid var(--success);">
                <h4 style="color: var(--success); margin-bottom: 10px;">ğŸ­ Fornecedores</h4>
                <p style="color: var(--gray-600); font-size: 14px;">GestÃ£o de fornecedores de metais reciclÃ¡veis e materiais.</p>
            </div>
            
            <div style="padding: 20px; background: var(--gray-50); border-radius: var(--radius-md); border-left: 3px solid var(--info);">
                <h4 style="color: var(--info); margin-bottom: 10px;">ğŸ“¦ Produtos & Estoque</h4>
                <p style="color: var(--gray-600); font-size: 14px;">Cadastro de tipos de metais e controle de entrada/saÃ­da de estoque.</p>
            </div>
            
            <div style="padding: 20px; background: var(--gray-50); border-radius: var(--radius-md); border-left: 3px solid var(--warning);">
                <h4 style="color: var(--warning); margin-bottom: 10px;">ğŸ’° Financeiro</h4>
                <p style="color: var(--gray-600); font-size: 14px;">Contas a receber, contas a pagar e controle de gastos operacionais.</p>
            </div>
        </div>
    </div>
</div>

<div class="card" style="background: linear-gradient(135deg, rgba(45, 90, 61, 0.05) 0%, rgba(45, 90, 61, 0.1) 100%); border: 2px solid var(--primary);">
    <div style="text-align: center;">
        <h3 style="color: var(--primary); margin-bottom: 15px; font-size: 20px;">ğŸ’¡ Dica Importante</h3>
        <p style="color: var(--gray-700); font-size: 15px; max-width: 700px; margin: 0 auto;">
            Lembre-se de fazer backup do arquivo <code style="background: var(--primary); color: white; padding: 3px 8px; border-radius: 4px;">data.json</code> regularmente. 
            Ele contÃ©m todos os dados do sistema!
        </p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Carregar estatÃ­sticas do dashboard
    async function loadStats() {
        try {
            const [clientes, produtos, contasPagar, contasReceber] = await Promise.all([
                fetch('/api/clientes').then(r => r.json()),
                fetch('/api/produtos').then(r => r.json()),
                fetch('/api/contas-pagar').then(r => r.json()),
                fetch('/api/contas-receber').then(r => r.json())
            ]);

            document.getElementById('total-clientes').textContent = clientes.length;
            document.getElementById('total-produtos').textContent = produtos.length;
            
            const totalPagar = contasPagar
                .filter(c => c.status === 'pendente')
                .reduce((sum, c) => sum + parseFloat(c.valor), 0);
            document.getElementById('total-pagar').textContent = formatCurrency(totalPagar);
            
            const totalReceber = contasReceber
                .filter(c => c.status === 'pendente')
                .reduce((sum, c) => sum + parseFloat(c.valor), 0);
            document.getElementById('total-receber').textContent = formatCurrency(totalReceber);
            
            showToast('Dashboard atualizado com sucesso!', 'success');
        } catch (error) {
            console.error('Erro ao carregar estatÃ­sticas:', error);
            showToast('Erro ao carregar estatÃ­sticas', 'error');
        }
    }

    // Carregar ao iniciar
    loadStats();
    
    // Atualizar a cada 30 segundos
    setInterval(loadStats, 30000);
</script>
{% endblock %}
